name: Update Release Description

on:
  release:
    types:
      - created

jobs:
  update_release_description:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Update Release Description
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # Fetch the last release's tag name using gh CLI
          last_tag=$(gh release list --limit 1 | grep -Eo '[0-9]+\.[0-9]+\.[0-9]+' | tail -n 1)

          # Check if the current release is the last one
          if [ "${{ github.event.release.tag_name }}" = "$last_tag" ]; then
            # Append "bla bla" to the release description using gh CLI
            updated_description="${{ github.event.release.body }}"$'\n'"bla bla"
            gh release edit "${{ github.event.release.tag_name }}" --notes="$updated_description"
          else
            echo "This is not the last release. Skipping update."
          fi
